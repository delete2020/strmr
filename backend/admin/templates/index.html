{% extends "base.html" %}

{% block title %}Dashboard - strmr Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Dashboard</h1>
    <p>Overview of your strmr server</p>
</div>

<!-- Status Overview -->
<div class="grid grid-4" style="margin-bottom: 1.5rem;">
    <div class="stat-card">
        <div class="stat-label">Backend Status</div>
        <div class="stat-value" style="display: flex; align-items: center; gap: 0.5rem;">
            {% if status.backend_reachable %}
            <span class="status-badge online"><span class="status-dot"></span> Online</span>
            {% else %}
            <span class="status-badge offline"><span class="status-dot"></span> Offline</span>
            {% endif %}
        </div>
        <div class="stat-subtext">Port {{ settings.server.port }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Usenet Connections</div>
        <div class="stat-value">{{ status.usenet_connections.total }}</div>
        <div class="stat-subtext">
            {{ settings.usenet | selectattr('enabled') | list | length }} provider(s)
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Debrid Status</div>
        <div class="stat-value" style="font-size: 1rem;">{{ status.debrid_status }}</div>
        <div class="stat-subtext">{{ settings.streaming.serviceMode }} mode</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Cache Limit</div>
        <div class="stat-value">{{ settings.streaming.maxCacheSizeMB }} MB</div>
        <div class="stat-subtext">{{ settings.streaming.maxDownloadWorkers }} workers</div>
    </div>
</div>

<!-- Quick Settings -->
<div class="grid grid-2" style="margin-bottom: 1.5rem;">
    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
                Usenet Providers
            </h2>
            <a href="/settings#usenet" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {% if settings.usenet %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Host</th>
                        <th>Connections</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for provider in settings.usenet %}
                    <tr>
                        <td>{{ provider.name }}</td>
                        <td>{{ provider.host }}:{{ provider.port }}</td>
                        <td>{{ provider.connections }}</td>
                        <td>
                            {% if provider.enabled %}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {% else %}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No providers configured</p>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/>
                </svg>
                Debrid Providers
            </h2>
            <a href="/settings#streaming.debridProviders" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {% if settings.streaming.debridProviders %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Provider</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for provider in settings.streaming.debridProviders %}
                    <tr>
                        <td>{{ provider.name }}</td>
                        <td>{{ provider.provider }}</td>
                        <td>
                            {% if provider.enabled %}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {% else %}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No providers configured</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Indexers and Scrapers -->
<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                Indexers
            </h2>
            <a href="/settings#indexers" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {% if settings.indexers %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for indexer in settings.indexers %}
                    <tr>
                        <td>{{ indexer.name }}</td>
                        <td>{{ indexer.type }}</td>
                        <td>
                            {% if indexer.enabled %}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {% else %}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No indexers configured</p>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <path d="M22 7l-10 7L2 7"/>
                </svg>
                Torrent Scrapers
            </h2>
            <a href="/settings#torrentScrapers" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {% if settings.torrentScrapers %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for scraper in settings.torrentScrapers %}
                    <tr>
                        <td>{{ scraper.name }}</td>
                        <td>{{ scraper.type }}</td>
                        <td>
                            {% if scraper.enabled %}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {% else %}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No scrapers configured</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Auto-refresh status every 30 seconds
    setInterval(async () => {
        try {
            const status = await apiCall('/api/status');
            // Update status indicators if needed
        } catch (e) {
            console.error('Failed to refresh status:', e);
        }
    }, 30000);
</script>
{% endblock %}
