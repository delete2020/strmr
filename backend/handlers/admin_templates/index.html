{{template "base" .}}

{{define "title"}}Dashboard - strmr Admin{{end}}

{{define "content"}}
<div class="page-header">
    <h1>Dashboard</h1>
    <p>Overview of your strmr server</p>
</div>

<!-- Status Overview -->
<div class="grid grid-4" style="margin-bottom: 1.5rem;">
    <div class="stat-card">
        <div class="stat-label">Backend Status</div>
        <div class="stat-value" style="display: flex; align-items: center; gap: 0.5rem;">
            {{if .Status.BackendReachable}}
            <span class="status-badge online"><span class="status-dot"></span> Online</span>
            {{else}}
            <span class="status-badge offline"><span class="status-dot"></span> Offline</span>
            {{end}}
        </div>
        <div class="stat-subtext">Port {{.Settings.Server.Port}}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Usenet Connections</div>
        <div class="stat-value">{{totalConnections .Settings.Usenet}}</div>
        <div class="stat-subtext">
            {{countEnabledProviders .Settings.Usenet}} provider(s)
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Debrid Status</div>
        <div class="stat-value" style="font-size: 1rem;">{{countEnabledDebrid .Settings.Streaming.DebridProviders}} provider(s)</div>
        <div class="stat-subtext">{{.Settings.Streaming.ServiceMode}} mode</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Cache Limit</div>
        <div class="stat-value">{{.Settings.Streaming.MaxCacheSizeMB}} MB</div>
        <div class="stat-subtext">{{.Settings.Streaming.MaxDownloadWorkers}} workers</div>
    </div>
</div>

<!-- Quick Settings -->
<div class="grid grid-2" style="margin-bottom: 1.5rem;">
    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
                Usenet Providers
            </h2>
            <a href="/admin/settings#usenet" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {{if .Settings.Usenet}}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Host</th>
                        <th>Connections</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Settings.Usenet}}
                    <tr>
                        <td>{{.Name}}</td>
                        <td>{{.Host}}:{{.Port}}</td>
                        <td>{{.Connections}}</td>
                        <td>
                            {{if .Enabled}}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {{else}}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No providers configured</p>
            {{end}}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/>
                </svg>
                Debrid Providers
            </h2>
            <a href="/admin/settings#streaming.debridProviders" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {{if .Settings.Streaming.DebridProviders}}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Provider</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Settings.Streaming.DebridProviders}}
                    <tr>
                        <td>{{.Name}}</td>
                        <td>{{.Provider}}</td>
                        <td>
                            {{if .Enabled}}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {{else}}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No providers configured</p>
            {{end}}
        </div>
    </div>
</div>

<!-- Indexers and Scrapers -->
<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                Indexers
            </h2>
            <a href="/admin/settings#indexers" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {{if .Settings.Indexers}}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Settings.Indexers}}
                    <tr>
                        <td>{{.Name}}</td>
                        <td>{{.Type}}</td>
                        <td>
                            {{if .Enabled}}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {{else}}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No indexers configured</p>
            {{end}}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <path d="M22 7l-10 7L2 7"/>
                </svg>
                Torrent Scrapers
            </h2>
            <a href="/admin/settings#torrentScrapers" class="btn btn-sm btn-secondary">Edit</a>
        </div>
        <div class="card-body">
            {{if .Settings.TorrentScrapers}}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Settings.TorrentScrapers}}
                    <tr>
                        <td>{{.Name}}</td>
                        <td>{{.Type}}</td>
                        <td>
                            {{if .Enabled}}
                            <span class="status-badge online"><span class="status-dot"></span> Enabled</span>
                            {{else}}
                            <span class="status-badge offline"><span class="status-dot"></span> Disabled</span>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p style="color: var(--text-muted); text-align: center; padding: 1rem;">No scrapers configured</p>
            {{end}}
        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script>
    // Auto-refresh status every 30 seconds
    setInterval(async () => {
        try {
            const status = await apiCall('/admin/api/status');
            // Update status indicators if needed
        } catch (e) {
            console.error('Failed to refresh status:', e);
        }
    }, 30000);
</script>
{{end}}
